<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Yuchi 的學習筆記</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Yuchi 的學習筆記">
<meta property="og:url" content="https://yuchitung.github.io/index.html">
<meta property="og:site_name" content="Yuchi 的學習筆記">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yuchi 的學習筆記">
  
    <link rel="alternate" href="/atom.xml" title="Yuchi 的學習筆記" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yuchi 的學習筆記</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yuchitung.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-cross-origin-resource-sharing" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/28/cross-origin-resource-sharing/" class="article-date">
  <time datetime="2019-06-27T16:31:23.000Z" itemprop="datePublished">2019-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/28/cross-origin-resource-sharing/">CORS 的介紹與實作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在介紹CORS 之前先討論一下什麼是<code>同源政策</code></p>
<h2 id="同源政策-same-origin-policy"><a href="#同源政策-same-origin-policy" class="headerlink" title="同源政策 (same origin policy)"></a>同源政策 (same origin policy)</h2><p>意思就是兩個網頁有相同的<code>domain</code>、<code>protocol</code>以及<code>port</code>號，只要三者有一個不相同即為不同源。</p>
<p>不同源的舉例：</p>
<ul>
<li>從自己的網站向一個第三方 API 發出請求。</li>
<li>從 CDN 載入一些網路資源，例如 CSS、JS、圖片等</li>
</ul>
<p>現代瀏覽器基於安全性考量在你發出非同源的請求時，request 會發出，但是 response 會被瀏覽器擋下來，並且在瀏覽器的 console 裡可以看到錯誤訊息，例如下面這張圖：</p>
<p><img src="https://lh3.googleusercontent.com/OLH4tOE_tnXj9ttrWi-k_N59qOVuGuXhNLYAp-427z_S2qyFGBMz0dJC_tCoQSMCYVPZxAckd7NWklLbfqX7cJa8o3JR1ZReyL6TJw6IItohPM8Oejd_OoRgmD38cATswUMvznBPvW9VC15pILxk32zZsF7o_pdGIUvupR590YGVOranbEbwaOAJPxlTwCOOYoDQ_6SK09J092kJgJ9Lr-eZm03HVbFv8vaWI0sm2VNuLDbvasU6VqCnzGl0lB9tLv7p9ELuP8bkPQ3HzlRygV0LmQci-HxEcpo_ndl9QoNctxk_5gHZrXe0TpYn7fa8p7LXrIRQD1kf3E_TQNywvxd69TDQjUSrNJDA7SFE_-6TTWw3r4Seoe9qEcMhDWf7G_T28a_S33LDiicBug2l71Z7v-c6dPXo0vnLpoUpFDz50O67Iig-U7Q9sPSxPuefI1d-x8Pux5b18TpuHU1ROiNXhD_d8Oh-nEpu7PteKskpmYR_udAAf7KeAd3rJ6sdQjfRumi9lw2Klf0BwuRydPrHRibTdQGhct41WVPnXtQSQO378dHYW2M9LuWblgDTcIUVOUpPfvTaLKXXwiov4YUc8WuATuat9xNqrBTNVQ4rXSnDG8cUYGJTVXgbvc5kpspwHqYe0yEPtAUmu5UJVW5wekpwnKfLbzq9eqfxDDcChmpZUgUzgLJJ=w783-h115-no" alt="same origin policy error"></p>
<p>那要怎麼解呢？<br>只要依循 CORS 就可以了。<br>因為每當發起一個非同源的請求就會受到 <code>CORS</code> 的控制。  </p>
<h2 id="CORS-是什麼"><a href="#CORS-是什麼" class="headerlink" title="CORS 是什麼"></a>CORS 是什麼</h2><p><code>cors (Cross Origin Resource Shraring)</code> 就是 跨來源資源共用。</p>
<p>當你發起一個非同源的請求時， 被請求的 server 必須在 response 的 header 裡加上 <code>Access-Control-Allow-Origin</code> 的設定。<br>當瀏覽器收到 response 後，會查看 response 的 header，如果 header 上的 <code>Access-Control-Allow-Origin</code> 有出現發起請求的 origin ，瀏覽器就會解析 response，結果不會被擋下來。然後 header 大概會長下面這個樣子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 250</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Server: nginx</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Cache-Control: no-cache, no-store, must-revalidate, private</span><br><span class="line">Expires: 0</span><br><span class="line">Pragma: no-cache</span><br></pre></td></tr></table></figure>
<p>其中 <code>Access-Control-Allow-Origin: *</code> 表示任何來源都接受。<br>通常除非是公開的 API 服務，不然 server 上都會設定針對 origin 以及 http method 的限制。</p>
<h2 id="Simple-Request-amp-Preflight-Request"><a href="#Simple-Request-amp-Preflight-Request" class="headerlink" title="Simple Request &amp; Preflight Request"></a>Simple Request &amp; Preflight Request</h2><p>其實 CORS 又分為兩種情況，一種是簡單請求(<code>simple request</code>)，另一種則是預檢請求(<code>preflight request</code>)。<br>通常在沒有自訂 custom header 的情況下都是 simple request，而且也僅限於 GET、HEAD、POST，更多定義可以參考 <a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS#%E7%B0%A1%E5%96%AE%E8%AB%8B%E6%B1%82" target="_blank" rel="noopener">MDN 簡單請求</a>。</p>
<p>若是其他 HTTP method，如 DELETE 或是 PATCH 等，可能需要 server 驗證的情況，這時候會用到 preflight request。<br>假設我們要 DELETE 一筆資源，preflight request 會先發出一個 OPTION 的請求確認 server 是否接受該請求，如果接受才會發出真正的請求，如果不接受的話請求就會在這裡被中斷， DELETE 不會真的被送出。</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><ul>
<li>對於非同源的請求，server 還是會接受請求並處理，但是同時 server 也要在 header 設定許可的 <code>Access-Control-Allow-Origin</code> ，瀏覽器才會解析請求結果，否則結果會被瀏覽器所擋下</li>
<li>simple request 只會有一次的請求</li>
<li>preflight request 會先發出一個 OPTION 請求，待 server 許可後 client 才會發出真正的請求，故會有兩次 request 發出</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.techbridge.cc/2017/05/20/api-ajax-cors-and-jsonp/" target="_blank" rel="noopener">輕鬆理解 Ajax 與跨來源請求</a></p>
<p><a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS" target="_blank" rel="noopener">跨來源資源共用（CORS）</a></p>
<p><a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Server-Side_Access_Control" target="_blank" rel="noopener">伺服器端存取控制（CORS）</a></p>
<p><a href="https://stackoverflow.com/questions/10636611/how-does-access-control-allow-origin-header-work" target="_blank" rel="noopener">How does Access-Control-Allow-Origin header work?</a></p>
<p><a href="https://w3c.github.io/webappsec-cors-for-developers/#intro" target="_blank" rel="noopener">CORS for Developers</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/28/cross-origin-resource-sharing/" data-id="cjxevxj1p0000u4y5rvug2j7d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dependency-inversion-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/dependency-inversion-principle/" class="article-date">
  <time datetime="2019-06-24T14:37:28.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/dependency-inversion-principle/">依賴反轉原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Depend on abstractions, not on concretions.<br>– <cite>Robert C. Martin</cite></p>
</blockquote>
<p>依賴反轉原則，全名 <strong>Dependency Inversion Principle</strong>，簡稱 <strong>DIP</strong>。  </p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><p>高接模組不應該依賴低接模組，兩者應該要依賴其<code>抽象</code>，抽象不要依賴細節，細節要依賴抽象。<br>不要把程式碼寫死某種實作上。</p>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><ul>
<li>互動的部分交給<code>抽象類別</code>(abstract class)或<code>介面</code>(interface)</li>
<li>會改變的實作，就放到子類別裡面</li>
</ul>
<h2 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h2><p>設計階段就可以先以抽象層次的互動來避開這個問題<br>抽象層次不要太高，以免無法對焦於真正關注的類別特徵</p>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>來看個例子。<br>有一位計程車師機，他開著 Toyota 的車來工作。<br>但如果有天他換車了，換開 Nissan，原本的 drive function 就不能用了…</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaxiDriver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">drive</span><span class="params">(Toyota $toyota)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$driver = <span class="keyword">new</span> TaxiDriver();</span><br><span class="line">$driver-&gt;drive(<span class="keyword">new</span> Toyota);</span><br></pre></td></tr></table></figure>
<p>那來改一改吧！<br>不要寫死成開 Toyota，改成開車就好了(<code>依賴抽象</code>），這樣隨時換開什麼車都可以。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> car</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toyota</span> <span class="keyword">extends</span> <span class="title">Car</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nissan</span> <span class="keyword">extends</span> <span class="title">Car</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TexiDriver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">drive</span><span class="params">(Car $car)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$taxiDriver = <span class="keyword">new</span> TexiDriver();</span><br><span class="line">$taxiDriver-&gt;drive(<span class="keyword">new</span> Toyota);</span><br><span class="line">$taxiDriver-&gt;drive(<span class="keyword">new</span> Nissan);</span><br></pre></td></tr></table></figure>
<p>然後我們可以發現，如果需要的話，計程車司機(TexiDriver)還可以繼承人(Human)類別，然後 drive function 抽出去成介面(interface)，TexiDriver 再實作 driver 介面，都可以再向上抽象，增加使用的彈性。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://youtu.be/SLCajYNcThE?t=5165" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/dependency-inversion-principle/" data-id="cjxevxj1x0003u4y5k5q5w5zg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-interface-segregation-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/interface-segregation-principle/" class="article-date">
  <time datetime="2019-06-24T14:36:03.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/interface-segregation-principle/">介面隔離原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Make fine grained interfaces that are client specific.<br>– <cite>Robert C. Martin</cite></p>
</blockquote>
<p>介面隔離原則，全名 <strong>Interface segregation principle</strong>，簡稱 <strong>ISP</strong>。  </p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><p>用戶端程式碼不應該依賴它用不到的介面，依賴的介面都是有其必要性。<br>把不同功能的從介面中分離出來。</p>
<p><img src="https://lh3.googleusercontent.com/KIHAjE5DQyyvIkCP6G1YHLojWaN5aDcDkj60gNWE8OEy54_A1XAzDn6hBQNgH1TRXW4NpX0r6Y1TJzL097ezMmEFZVl71jFpKSQx2aV6-0S4tDY2kbnw3NRjp8tHUjMKv1OMQtUVeLgM95VRwEEJSdfhteNKQsYaxUvoPhZL-3iLLupj-n6TOTS4hzVQ_5-bbKo3wRu69c5xV-qz4OveH1vrDRbR5w9XqEcKV3U2Pf85s7JpCu2iEM8yBleWrC8IwmwHg69FauDo2maLXWhzq6nT9glSJqe5h580-O2Tcjh8uXECtMRDINgvilwGjIkftp2p8hCQInsON6sl49M69uS7j29Rp0TMPMY2x6cDrAn8tAOHaYuEiV98FC3VzRDngPduG6nlmmYgxdIRtDk-z_1QNRNDRkraMXJqve-rj_Qv6j_DnzRtdc2OXJyzk7idP_Hj3CtGrMw_CMKHdBei3kouwp2kuaiEjz07tUVBtbbmzh34iGMDx0OYPY6ApO_Mh5Xt0Tp_lPnSQsE4viaqlaONB6IPzigzuh4ptJWV-gCb9TWbRw65-BvSO1gpyUdT4OHdVpvCVtN4IhjS-jkeHPS-KwNC0-_8xPKhQiEHulYAoGQsG9cmiaqdEJ9iTH8TM-3WPIfHkQM-udR2oL6haTKWjULMYzsP=w800-h600-no" alt="其實我只是要打個果汁"><br><a href="https://www.supergeneral.com/int/product/multi-functional-stand-mixer-sgkf1096db/" target="_blank" rel="noopener">圖片來源</a></p>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><ul>
<li>把 Interface 當成「可以做什麼」， 而不是「是一個什麼」</li>
<li>減少讓每個 Interface 可以做的事</li>
<li>如果發現有空實作時，就表示 Interface 可以再細化</li>
</ul>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>來看看範例。<br>身為一個沒朋友的程序猿，最好的朋友就是家裡的毛小孩。<br>那就先來寫個寵物類別，再來條狗和一隻貓，最好還要能跟我玩飛盤。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchFrisbee</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchFrisbee</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">implements</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchFrisbee</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//cats do not catch frisbees</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'大膽刁民，竟敢造次!(抓)'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>醒醒吧！貓皇是不會和你玩飛盤的…<br>但是因為是實作了 Pet 介面，硬著頭皮還是要實作 catchFrisbee，<br>結果你家主子不理你，還違反里氏替換原則了…<br>所以，還是不要這樣搞了吧！再來改一改…</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Play</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchFrisbee</span><span class="params">()</span>: <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrainedDog</span> <span class="keyword">implements</span> <span class="title">Pet</span>, <span class="title">Play</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchFrisbee</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">implements</span> <span class="title">Pet</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這次我們把接飛盤這個動作從 Pet 類別抽出來，單獨定義成一個 Play 介面，以後不要再強迫你的主子陪你玩飛盤了。然後，再定義一個 TrainedDog 類別，只有這個類別實作 Play 介面，畢竟狗狗要能接飛盤也是要經過訓練的嘛！</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://youtu.be/SLCajYNcThE?t=4796" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/interface-segregation-principle/" data-id="cjxevxj1z0004u4y5wihyqons" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-least-knowledge-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/least-knowledge-principle/" class="article-date">
  <time datetime="2019-06-24T14:35:24.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/least-knowledge-principle/">最小知識原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最小知識原則，全名 <strong>Least Knowledge Principle</strong>，簡稱 <strong>LKP</strong>。  </p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><p>一個物件應該對其他物件有最少的了解，盡可能減少類別中的 public method，降低其他類別對此類別的偶合度。</p>
<p><img src="https://lh3.googleusercontent.com/RQPJ1WYsfRVgcfiL_OTfb1On7-HtxUAonHB_VMYlcDRuyBrPrsPHbmuq10g8oO6r1t4Y1GohtQEXuZczmrL4iQaraw-Qc4jDeYhNAKDQaxpX1CclKsdclgwdkrhQ67QD8fYsLILfnRZX4wIfFHfFRF-mOHTUhDSL3IIm52_mI8eJhseTVkTjjkFRVVRp23JdFHiP_0wS6Cn_qaQrPg6wbpjF4PXqEsoF4ooV75Jq-W4mOuUxFq8rdJuc6tfhiH8-3uaok-rY8KkSzygOp3ok1L7ouuRPoNGgOjDfi1boMX2N_UVeGlB6HcxrojocYaGBA9Pf0ULyyAA1jjjDPwnJAKgWhRrOUPmFT5-U5LOCUCowu57L8mRw2R_s-38wED4mhNxB02CwLDOwRo61iGVqm80JQxEWZbHxuenN9LDM7UCmERT6IDJw7xxtruZz-yvZfos3jbyWURbKgFQcsA61MqDyEZ2SCUBdt9mhLh8eILPD9Koq-yEYF3rQTB1zuYbY0wiJnONxyNF5cKHpcX33vRqlx95Ap53nwlxqC3wMZsoLaW1S4APrs42aOYUUFFHg8Qb81R9BZf-DnXeFistloumx1q16PIifBpkQff8K6D7nuoWDMjUPRj9bWvAkqQNdHQADKYAGUOVIjNG1fXrEpGw9D0lhKHQA=w600-h312-no" alt="你知道的太多了"></p>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><ul>
<li>已經成形的操作流程就封裝起來</li>
<li>不必要的公開方法就設為 private 或 protected</li>
<li>外面知道的越少，偶合度就越低</li>
</ul>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>假設我們今天要開一間洗衣店，首先寫個洗衣服務。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LaundryService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $clothing;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constrcut</span><span class="params">(array $clothing)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;clothing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanSpecialStain</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">wash</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dry</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">iron</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    $service = <span class="keyword">new</span> LaundryService($dirtyClothes);</span><br><span class="line">    $service-&gt;cleanSpecialStain()</span><br><span class="line">            -&gt;wash()</span><br><span class="line">            -&gt;dry()</span><br><span class="line">            -&gt;iron();</span><br></pre></td></tr></table></figure>
<p>嗯，看起來很不錯。<br>從清除特殊污漬、清洗、烘乾、到整燙，服務很完整。<br>SOP 流程很明暸， 但是有一個問題，想使用這個洗衣服務的人都居然要知道這個固定的 SOP!!!<br>既然這是固定的作業流程，我們還是將它封裝起來吧！免得有人不照著流程亂搞。或是有一天老闆佛心來地想要把除毛球服務加到固定流程裡，但是客人不知道。</p>
<p>所以，再來把這個 SOP 流程給包裝起來，讓使用這個服務的人只要呼叫 doLaundry 函式就可以了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LaundryService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $clothes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constrcut</span><span class="params">(array $clothes)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;clothes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doLaundry</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cleanSpecialStain()</span><br><span class="line">             -&gt;wash()</span><br><span class="line">             -&gt;dry()</span><br><span class="line">             -&gt;iron();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanSpecialStain</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">wash</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">dry</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    privat <span class="function"><span class="keyword">function</span> <span class="title">iron</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    $service = <span class="keyword">new</span> LaundryService($dirtyClothes);</span><br><span class="line">    $service-&gt;doLaundry();</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://youtu.be/SLCajYNcThE?t=4527" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/least-knowledge-principle/" data-id="cjxevxj230009u4y529z0aliq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-liskov-substitution-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/liskov-substitution-principle/" class="article-date">
  <time datetime="2019-06-24T14:34:38.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/liskov-substitution-principle/">里氏替換原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Derived classes must be substitutable for their base classes.<br>– <cite>Robert C. Martin</cite></p>
</blockquote>
<p>里氏替換原則，全名 <strong>Liskov substitution principle</strong>，簡稱 <strong>LSP</strong>。  </p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><p><code>子類別要能替換掉父類別</code>而不影響程式架構，並且所有<code>父類別能做的事，子類別也要可以做</code>。</p>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><ul>
<li>對介面寫程式，重點放在要執行的動作  </li>
<li>方法簽名、回傳值與丟出的異常要一致  </li>
<li>思考繼承時子類別所造成的「行為變化」要如何設計才<code>不會違反父類別介面的合約</code></li>
</ul>
<h2 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h2><ul>
<li>依賴子類別的地方不能用父類別取代</li>
<li>拋棄繼承，思考可否改用組合的方式</li>
</ul>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>來看看範例。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scooter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> $name;</span><br><span class="line">   <span class="keyword">private</span> $fuelTankCapacity;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFuelTankCapacity</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Yamaha extends Scooter()</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Kymco extends Scooter()</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Gogoro extends Scooter()</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>是不是有點怪怪的…Gogoro 沒有油箱啊！！！<br>子類別並沒有完全實作父類別有的功能，違反了里氏替換原則。<br>那麼來稍微改一下程式。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElectricScooter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line">    <span class="keyword">private</span> $batteryCapacity;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBatteryCapacity</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Gogoro extends ElectricScooter()</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scooterist</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $scooter;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setScooter</span><span class="params">(Scooter $scooter)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;scooter = $scooter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$yamaha = <span class="keyword">new</span> Yamaha();</span><br><span class="line">$scooterist = <span class="keyword">new</span> Scooterist();</span><br><span class="line">$Scooterist-&gt;setScooter($yamaha);</span><br></pre></td></tr></table></figure>
<p>另外定義一個 ElectricScooter 類別，然後讓 Gogoro 去繼承它，就解決了這個問題。<br>並且每個子類別都可以替代其父類別，也符合里氏替換原則。最後，也許再把動力來源抽出來定義成介面會更好，不過還是要實際情況來考慮。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://youtu.be/SLCajYNcThE?t=3775" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/liskov-substitution-principle/" data-id="cjxevxj28000gu4y5myd8c0x2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-open-closed-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/open-closed-principle/" class="article-date">
  <time datetime="2019-06-24T14:33:35.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/open-closed-principle/">封閉開放原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>You should be able to extend a classes behavior, without modifying it.<br>– <cite>Robert C. Martin</cite></p>
</blockquote>
<p>封閉開放原則，全名 Open-closed Principle，簡稱 OCP。</p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><blockquote>
<p>對擴充開放，對修改封閉。</p>
</blockquote>
<p>第一次看到的話是不是很匪夷所思，要怎麼新增功能又不修改程式碼呢？<br>其實是<code>新增功能(擴充)，但是不修改舊有的功能(對修改封閉)</code>，也就是只要把程式寫成在之後要新增功能時，不需要改動原本有的功能就好了。</p>
<h2 id="怎麼做呢？"><a href="#怎麼做呢？" class="headerlink" title="怎麼做呢？"></a>怎麼做呢？</h2><p>實踐這個原則的手法有不少，還是要依照實際的情境選擇適合的方法。<br>以下是可以參考的作法：</p>
<ul>
<li>利用繼承</li>
<li>利用抽象介面</li>
<li>依賴倒轉 (Dependency Injection pattern, DIP)</li>
<li>裝飾者模式</li>
<li>策略模式</li>
</ul>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><p>如果還是不知道麼開始的話，試著用<code>抽象層級</code>的方式去思考類別，不要把功能寫死，試著寫成抽象的概念，然後把會<code>造成改變的選項較給別的類別處理</code>，主要類別還是專心處裡核心任務。最後，通常變化都是後來才出現的，一開始設計的時候，不一定會構思到要這樣寫，之後再透過重構完成即可。</p>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>看個範例吧！<br>下面這一段程式碼，假設我們有一台 Nintendo 主機，然後我們手邊有三款遊戲可以玩，要玩的時候呼叫 play function 就可以了。<br>但是，如果我每買一款遊戲就要新增遊戲在這個 Nintendo 類別裡面…</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nintendo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">(string $game)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">switch</span> ($game) &#123;</span><br><span class="line">           <span class="keyword">case</span> <span class="string">'mario'</span>:</span><br><span class="line">               $mario = <span class="keyword">new</span> Mario();</span><br><span class="line">               $mario-&gt;start();</span><br><span class="line">           <span class="keyword">case</span> <span class="string">'car-racing'</span>:</span><br><span class="line">               $carRacing = <span class="keyword">new</span> CarRacing();</span><br><span class="line">               $carRacing-&gt;start();</span><br><span class="line">           <span class="keyword">case</span> <span class="string">'pokemon'</span>:</span><br><span class="line">               $pokemon = <span class="keyword">new</span> Pokemon();</span><br><span class="line">               $pokemon-&gt;start();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>試著改改看…<br>把 game 抽出來寫成介面，定義一些所有遊戲都會需要的基本功能，之後每一款遊戲再各自去實作細節。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Game</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mario</span> <span class="keyword">implements</span> <span class="title">Game</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $mario;</span><br><span class="line">   <span class="keyword">protected</span> $wario;</span><br><span class="line">   <span class="keyword">protected</span> $luigi;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">//initialize characters...</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarRacing</span> <span class="keyword">implements</span> <span class="title">Game</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pokemon</span> <span class="keyword">implements</span> <span class="title">Game</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下來，把 Nintendo 改成這樣</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nintendo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">(Game $game)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       $game-&gt;start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以後，每新增一款遊戲<code>(對擴充開放)</code>，我們也不會動到 Nintendo 了<code>(對修改封閉)</code>，喔耶！<br>而且 Nintendo 在呼叫 play 時，也不用管你是什麼遊戲，只要讓遊戲呼叫 start 就好了。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.youtube.com/watch?v=SLCajYNcThE&amp;t=954s" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/open-closed-principle/" data-id="cjxevxj26000du4y5svjwxv5c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-single-responsibility-principle" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/single-responsibility-principle/" class="article-date">
  <time datetime="2019-06-24T14:33:06.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/single-responsibility-principle/">單ㄧ職責原則</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>A class should have one, and only one, reason to change.<br>– <cite>Robert C. Martin</cite></p>
</blockquote>
<p>單ㄧ職責原則，全名 <strong>Single Responsibility Principle</strong>，簡稱 <strong>SRP</strong>。<br>個人覺得 SRP 是 SOLID 六大原則中最簡白易懂的原則。  </p>
<h2 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h2><p>應該且僅有一個原因引起類別的變更，讓類別只有一個職責。</p>
<h2 id="秘訣"><a href="#秘訣" class="headerlink" title="秘訣"></a>秘訣</h2><ul>
<li>關注點分離，一個類別只應有一個核心任務</li>
<li>不要貪方便全塞一起</li>
<li>注意切太細會有類別太多的問題</li>
</ul>
<h2 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h2><ul>
<li>設計階段就可以避開類別職責太大的問題</li>
<li>但小心在維護階段受到誘惑又讓類別職責變多，所以，想清楚類別的<code>核心價值</code>，若是需要開新的類別，當開則開</li>
</ul>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><p>先來看一個例子，下面這個例子是否有可以優化的地方？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $products;</span><br><span class="line">    <span class="keyword">private</span> $amount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calculateAmount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;products) &#123;</span><br><span class="line">            <span class="comment">// calculate total amount...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">printInvoice</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         <span class="comment">//download a PDF invoice</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">printPackingList</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//download a PDF packing list</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>稍微修改一下，把輸出檔案的部分拆出來，這樣 Order 是不是看起來就更能專注在核心的工作項目上，有關輸出成單據的部分都拆出去，之後也可能會有不同的單據要輸出，擴充性也能更好。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $products;</span><br><span class="line">    <span class="keyword">private</span> $amount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calculateAmount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;products) &#123;</span><br><span class="line">            <span class="comment">// calculate total amount...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Printable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(Order $order)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InvoicePrinter</span> <span class="keyword">implements</span> <span class="title">Printable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(Order $order)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $contensts = $order-&gt;getContents();</span><br><span class="line">       <span class="comment">//prepare PDF then download...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackingListPrinter</span> <span class="keyword">implements</span> <span class="title">Printable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(Order $order)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $contensts = $order-&gt;getContents();</span><br><span class="line">       <span class="comment">//prepare PDF then download...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://youtu.be/SLCajYNcThE?t=1953" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a><br><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" target="_blank" rel="noopener">The Principles of OOD</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/single-responsibility-principle/" data-id="cjxevxj2a000lu4y5re69lwgq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-solid" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/solid/" class="article-date">
  <time datetime="2019-06-24T14:31:44.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/solid/">淺談 SOLID</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>你該學的不是設計模式<br>而是物件導向開發原則<br>– <cite>大澤木小鐵</cite></p>
</blockquote>
<p>初學者在學習設計模式的時候，常常一知半解，學了以後好像也不是能很順利並適當地使用在專案上，筆者也是如此。直到看過鐵哥講解 SOLID 後，才意識到在使用設計模式之前，應該先好好學習 SOLID 的精神。鐵哥曾說過如果能掌握 SOLID，有沒有一定要使用設計模式也就沒有那麼重要了。可以想見，SOLID 是多麽重要的一個概念。</p>
<h2 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h2><p>SOLID 是由 Robert C. Martin(Uncle Bob)在 Agile software development (2002) 一書中提到的五個設計原則。很推薦做為物件導向程式開發時的一些心法，是五個概念的縮寫，但是在學習 SOLID 時有的文章也會列入 LKP ，所以筆者也將之列了進來：</p>
<p><strong>單一職責原則 (Single responsibility principle, SRP)</strong><br><strong>開放封閉原則 (Open-Close principle, OCP)</strong><br><strong>里氏替換原則 (Liskov substitution principle, LSP)</strong><br><strong>最小知識原則 (Least knowledge principle,LKP)</strong><br><strong>介面隔離原則 (Interface segregation principle, ISP)</strong><br><strong>依賴反轉原則 (Dependency inversion principle, DIP)</strong></p>
<p>若是開發的時候能遵守這六個原則，程式的品質也會大大提升。</p>
<p>再次節錄一段鐵哥在簡報裡放的整理：</p>
<p><strong>SRP: 降低單一類別被「改變」所影響的機會</strong><br><strong>OCP: 讓主要類別不會因為「新需求」而改變</strong><br><strong>LSP: 避免繼承時子類別所造成的「行為改變」</strong><br><strong>LKP: 避免暴露過多資訊造成用戶端因流程調整而改變</strong><br><strong>ISP: 降低用戶端因為不相關介面而被改變</strong><br><strong>DIP: 避免高階程式因為低階程式改變而被迫改變</strong>  </p>
<h2 id="面對改變"><a href="#面對改變" class="headerlink" title="面對改變"></a>面對改變</h2><p>如果看完了這些原則，也許會發現其實 SOLID 就是在說<code>面對改變的策略</code>。<br>需求總是一直在變的，但是我們要怎麼在每次變化的過程中，確保改變不會帶來災難，或是埋下壞味道的種子，試著用 SOLID 去思考我們的程式碼，就可以降低改變帶來的影響。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.youtube.com/watch?v=SLCajYNcThE&amp;t=954s" target="_blank" rel="noopener">PHP 也有 Day #19 - PHP 返樸歸真系列之從實例學設計模式 by 大澤木小鐵 (Jace Ju)​</a><br><a href="https://clouding.city/php/solid/" target="_blank" rel="noopener">物件導向設計原則 SOLID</a><br><a href="http://teddy-chen-tw.blogspot.com/2014/04/solid.html" target="_blank" rel="noopener">SOLID：五則皆變</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/24/solid/" data-id="cjxevxj2b000mu4y5xda4d2lc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oop/">oop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solid/">solid</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mvc-and-mvvm" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/15/mvc-and-mvvm/" class="article-date">
  <time datetime="2019-06-15T12:31:34.000Z" itemprop="datePublished">2019-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/15/mvc-and-mvvm/">淺談 MVC &amp; MVVM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="為什麼要分層？"><a href="#為什麼要分層？" class="headerlink" title="為什麼要分層？"></a>為什麼要分層？</h2><p>實踐單一職責原則，將工作項拆分，各單元只專注在自己的工作上。<br>而前後端分離的概念更甚者把資料的提供與畫面的呈現完全拆分開來。</p>
<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p>MVC 這個名字是來源自桌面應用程式的架構，而在 web 世界裡，其實 MVC 真正的名字應是叫做 Model2，但是因為同樣都有 model、controller、view 的結構，所以名字常被誤用，久而久之，大家也都習慣稱其為 MVC，以下內容也都以 MVC 稱呼之。</p>
<p>MVC 是最基本且常見的分工架構，MVC 架構中將工作分成三層：</p>
<ul>
<li><p>Model:<br>負責與資料庫之間的聯繫，以及處理資料邏輯。</p>
</li>
<li><p>View:<br>負責視覺的呈現。</p>
</li>
<li><p>Controller:<br>在 view 與 model 之間的橋樑，屬於分配者或是控制者的角色。</p>
</li>
</ul>
<p><img src="https://lh3.googleusercontent.com/3_mvHSPfMqe88SnmOLFaPpMhJnS71aDk0BjSSUQ2gwBNYMJa_JjFFIJ2P78CWB7nphzEyLx9fPo794UTnNmv23oz0Bbo4hX0RlG6zccKaAF36ijONad8abe1dIU3x-eBPiVd9dPs41HvmgyFSOKWFcgaF6w5ouJvVnZRj4invbFlqOPtrWoInw3s9jTptdv4-NbMahy-f_IXYvJLoulq-D5FMGB3jiw7p0fYNS558DIoazBNg0-eohrNHuRSzAiD_h6B89BF0G16J9oP4zfIhYzkOy6ZmXvTR0YWxnB4qrIMcl_z9Xtp-Vjmp2RezR7eOMBJxSpCxIvbn7xS_2XHSNp5zufJNbbS6inyj9oU-jqy8CQTRjd0ODRVoMfL4Fl_FuRJyBdDX7qqeDBEe1N3Kwen---XFPmbpCVC12vwM90yi1MrP1Y_73w_kLX3xn7MdrQtmCean3VFrSNOdG-aKk2kJbNk-BpTzAV-Q79VtFsJ34_2KDCy2YEoDIIMc_SWHbxk2go6W-uftauLdLY8yNIlN1EmLdNOjbhm_vpLGX-j8YP7FzaJLsGEhZg-2w_PJZNoldQk90jBFIg4TZlhR-z54EExqjpOuufJOiTQK_Qw0J1AIQS-1KtU-S2Vth5CFbYEQr5slKmcz5HMfVVrMA5lWGU_XZ5M=w1145-h955-no" width="50%"></p>
<p><br></p>
<h2 id="Server-side-render-下的-MVC"><a href="#Server-side-render-下的-MVC" class="headerlink" title="Server side render 下的 MVC"></a>Server side render 下的 MVC</h2><p>在 server side render 的架構下，整個網頁包含資料和視覺呈現都是在後端處理，瀏覽器只是顯示整份 html。</p>
<p><img src="https://lh3.googleusercontent.com/dud2BZvQy6gTu55Au4v_f47cZXfpqgcJCkibutTDVZyPHb8RrFWcnb1CgtoOiUxNbLo4zrRtxCCjMniCmBDWREOcVZtkkBGAPnAeG4sK51GmqgZeFU22T_1djOp9h__Eg_nELYeDByb2U3bmsp8CVK_zRFl5FyS1SeFGS_f2ej8nNbPKRV_x5eqkPBIXM9BJtOjkZkZoxoaTMZigpqYY4bL-luROi-Fby_X2nWF9OHdtyjLz0gJRBEHIe0kQ9TLB8LrV9Fso8GsKGMsFZ66oxhTmW0fkoLdWKRBw2mT0E5iCB0DZg5gvaJKN_3XynM6g5yOeu0XkIc9LiL_gGlV44RL2MP1Jy0whjvdWKM1fLsKEy1GgDwol_Brg1Y-HVvPSCDNPTb5y5bNaSv3ZT5yYk92YCqHbRtApXmCY6_3HAWniI18C76BcWcZffGFeov2l1FgyvAtCv-WbaErG77cqHhGy1LKT2j_n7H0qnz6-6DWYDcQDtUh5Xt3mW9cOchJUgJrYkFV4t0aEMVvOG9N6MXRjGrNlvI3KM6z25BCa9JmZG8pzxuDSuOASO_aC8c7GP_CC6nwqTr0n9JnoZFDSGD5XEQpGWdlUcaOddsHoFTyexyYodom5sKFH2PlptpsPsP8CrqThtr6f5QJfCU3UmHrPcDyR8gvV=w2210-h924-no"></p>
<p><br></p>
<h2 id="Client-side-render-下的-MVC"><a href="#Client-side-render-下的-MVC" class="headerlink" title="Client side render 下的 MVC"></a>Client side render 下的 MVC</h2><p>現代的網頁為了讓使用者有更好的使用體驗，不要每個動作或是切換頁面都重新刷新整個頁面。誕生了client side render 的做法，一開始載入 document 時只是一個空的 html，所有的資料都是之後用動態載入，再埋入 html 裡面。</p>
<p>可以看到，這樣的架構下，server 是不處理有關 view 呈現的工作，都是交由前端在瀏覽器完成。而圖中那個 view 區塊事實上是可以進一步拆成前端的 MVC 或是 MVVM。<br><img src="https://lh3.googleusercontent.com/gh3hpwEP9ktXgaDdsE9eZRn-EGm8atYMkQo0b_5vSVS9Mxai13h98qC4JAcZUjsEVFsuP3FlzD1Hf_t5I1eX4WjX3EUuKHa9s1Bf7tO_oT63yXVaNvz9umLLMLpaY0jnt1YN5D47_ua3CsOuiT72nf6wFgV_UUs3Hnbtl6M93wdSUtb2gPOz6QPUSqO1AZHtwXlraKQB58RapG3a0psO5o2_h4gH_yeewuK6Z6u9z0YkO1epVlrpB5kTY5RsbNYW44udMR5vJ5AesSX-WCnV6EzJzDcvTx_iXozKTl6aBDiCVSaXOym9PbDnE1NVkJzTX8sNeKRCZOpo45w0tnId7zavsbaZZRIeQBkS1yKb94p7773yYWppEn_HXsp0PFYmtwpoXffLayN5psa-cGeVYE6PtJa0-p4Rj8PBZ2AV2t_K2SzPKApXPz9vQTgyUdqbmstv1wonbfg3RzzOBvft3z8q3lkzoWYiaoTbp20YJyMNHYgN6LT19BT6KEzv_W7PPIcfT5NVsyoLjONzaRjVQqmuhPuDN2OwWmqXSXyGJ5nP8XZDM4N7lYzlktH4FYKuS_69MqgG-zGmte0y2j-eJkapLy6fJrVJNOZ1uDBAHtf-G9MZioM2SKxqMBbuLLl9mXzwjOwaVSMre21ogkI_SMfTN4RiWUZ-=w2210-h1306-no"></p>
<p><br></p>
<h2 id="前後端大亂鬥"><a href="#前後端大亂鬥" class="headerlink" title="前後端大亂鬥"></a>前後端大亂鬥</h2><p>來看看，把前後端整合起來，會長怎樣呢？</p>
<p><img src="https://lh3.googleusercontent.com/O3i0ebnnsTPESDGul3vKXGvZ6OF4sumgNW1P163Timl0xVFv91oISZGLczUjJ3ASqbBRBek6Phd94hFhjvqAYncAGiJSrZB2q9c3shzPHfR0JqneAmyTWovnnN92-tPT0Viv_ToVHW3vWXA-Aue6eoqFjbLnJ1S3qfuqrkdHzL5-VT4doR9gLNeYumxNf7EKymMVNX_mYxHR2vADLpCboga4bIrW2cn1tgHlER1S6c5sRaeSGo4VdW8HrHJoeCy8RbvDI4eZDCLjbi9QY1mTBQWhMeDRb2VaBU4V7y4_zIEtMNIy8BGcIbnct1R3ctkeTHJcxRJbFvg_y_BGg_RBZLqiQxy3lesQNRk-J_YX32pbFnwv4IrzrA5NyrJYyIjQ9nb9vRxSoVy5bsqNM_pwMqJqtnwTtnVTM9lQ7hsKwN0mMFEwK2Cax0qXl5NUsVWcvfpiE-lpUzNjpj6RQrz4p5CcL8fH0XzMw90zODwUN42KLJ43d9oaMIeUH8bIT1wXPmxwzOdb9uap1PyGajPnpOPmB9hQNswK_mt9ftO4qZb6uqdkFNN1nLcyS_7tfOu4_RHK5ZqcszN36MVSWOzKE367I-_wmMk6-qcWRZRsScyxjNpRaJv9Zih4Jn2ASGH3yKZRoLCE7HwYU8HCxzLeUnqMO-QEanmu=w1264-h1544-no"></p>
<h2 id="MMVM"><a href="#MMVM" class="headerlink" title="MMVM"></a>MMVM</h2><p>基於前端需求所發展出的架構。<br>分層如下：</p>
<ul>
<li>Model:<br>通常是與 server 介接取得資料，或是處理 client 端預先載入的資料。</li>
<li><p>View:<br>負責視覺的呈現。</p>
</li>
<li><p>View-model:<br>在 view 與 view-model 之間的橋樑，達成資料雙向綁定的效果。當 view 有動作被觸發，會自動更新 model，model 有資料更新也會自動更新 view。由於實現了雙向綁定，view-model的內容會即時呈現在 view 層，前端開發者再也不必繁複地通過 js 或是 jQuery 操縱 DOM 去更新 view，而 view 和 model 也就此解耦合，前端的工作分工更為乾淨。常見使用 MVVM 的框架有 angular, vue。<br><img src="https://lh3.googleusercontent.com/r6Wno2Ph5aXFBVUuWCa5XpYfWPnoSFh3Kj8dKafx5iLjUReDWvJUVpEKvVoDBJYCPfreEB6q3BHMPltkQyRIz4DkwgYUlnj0iDUq2HrNd7ixah6llcVAq10C3yQoZEBmiw8-EvsW18CC45IGLUCDLZwQJofEAJHJVpDal7n7cQkqL5NcaZsNPcc_47LSNljuzl56qZ-lNgcG2-hKGSt4ghQcOwnXfXYGtyXno-lDWF9uLjqH3qLnRdKCRSLpyh7M5N7pefhMKK6XZ7ZLEZJU57Ni5rEINqjfdMQbT9u2SqT0pNgzRaPZzet2Efaq3UAk_4RC3pwJa8i_KJuBGfUccqdOB12G-9k6-y_Xn1XncYxlieQvjTWNwaysWneRnJVZL4U_2LtHHa-DKnDqmP8Ln7NVqWwfluBWX0j9WoD91NnbtbKgrEcSEDj29NkNSY4nCc9B4ln0C7HBOkn-KPvn-da1njuHieDuap5sKytLveu2G4_NIgFD5BU8iRKUoKSaS8rrQez60Us_ivRMd7KMADz5kzcnhhEScBEx5GTskBLP-4syOUFQjN67uR3lyM84AHNUhZnsiXSgt-1-F9xQQ2i1pmHdoJHTaTBPQODdjTwRENfmLbYMtZVKL1EqxZiy_EzgcUdloPfuIQS8CJltVeXMf2Z5JZeF=w1145-h960-no" width="50%"></p>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.ithome.com.tw/node/77330" target="_blank" rel="noopener">MVC與Model 2的變異與結合</a></p>
<p><a href="https://blog.techbridge.cc/2017/09/16/frontend-backend-mvc/" target="_blank" rel="noopener">前後端分離與 SPA</a></p>
<p><a href="http://www.syscom.com.tw/ePaper_New_Content.aspx?id=498&amp;EPID=219&amp;TableName=sgEPArticle" target="_blank" rel="noopener">淺談MVVM架構</a></p>
<p><a href="https://draveness.me/mvx" target="_blank" rel="noopener">淺談MVC、MVP 和MVVM 架構模式</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/06/15/mvc-and-mvvm/" data-id="cjxevxj25000cu4y5sjezm9cl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-identify-users-with-cookie-and-session" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/15/identify-users-with-cookie-and-session/" class="article-date">
  <time datetime="2019-04-14T23:58:20.000Z" itemprop="datePublished">2019-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/15/identify-users-with-cookie-and-session/">使用 cookie 和 session 來紀錄使用者狀態</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>HTTP 本身是無狀態(Stateless)的通訊協定(Protocol)。<br>但是可以用 cookie ＆ session 在客戶端與伺服器之間存取一些使用者狀態。<br><br></p>
<h2 id="session-amp-cookie"><a href="#session-amp-cookie" class="headerlink" title="session &amp; cookie"></a>session &amp; cookie</h2><p>在講解如何處理使用者狀態之前，先簡單釐清 cookie &amp; session。<br>cookie 是存在 client 端的，session 是存在 server 端的。<br><br></p>
<h2 id="如何用-session-紀錄使用者狀態"><a href="#如何用-session-紀錄使用者狀態" class="headerlink" title="如何用 session 紀錄使用者狀態"></a>如何用 session 紀錄使用者狀態</h2><p>想像去飲料店點飲料，店員發給你號碼牌，之後你可以用號碼牌來領你的飲料。<br>你就是 client，飲料店就是 server，號碼牌就是 session id。</p>
<p>換到真實的情境，server 端設定 session 開始後，會自動產生一個 session id。<br>這時候我們可以在 session 裡額外加上 user id。<br>接著在 response headers 會自動被加上下面內容，指示瀏覽器要存一個名為 PHPSESSID 的 cookie。</p>
<p>response header<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: PHPSESSID=8afd28b38e013478f508473db0dfd172; path=/</span><br></pre></td></tr></table></figure></p>
<p>之後 client 端每次向 server 請求時就會夾帶著 cookie。</p>
<p>request header<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: PHPSESSID=8afd28b38e013478f508473db0dfd172</span><br></pre></td></tr></table></figure></p>
<p>server 端收到後就會根據 session id 來識別這是哪個 session 的請求，<br>這時候我們只要再看看 session 裡的 user id 就知道哪位 user 了。特別說明一下，中間 cookie 夾帶 session id 的傳遞都是背後會自動去執行的，server 和 client 都不用做額外的操作。</p>
<p>缺點：</p>
<ul>
<li>session 過期前會一直佔用 server 資源<br><br></li>
</ul>
<h2 id="用-session-實作-login-amp-logout"><a href="#用-session-實作-login-amp-logout" class="headerlink" title="用 session 實作 login &amp; logout"></a>用 session 實作 login &amp; logout</h2><p>以下用 session 來實做一下使用者登入。</p>
<p>Login form<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> placeholder=<span class="string">"Enter your username"</span> required&gt;</span><br><span class="line">    &lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span> placeholder=<span class="string">"Enter your password"</span> required&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<p>Process Login<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( ! <span class="keyword">empty</span>( $_POST ) ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">isset</span>( $_POST[<span class="string">'username'</span>] ) &amp;&amp; <span class="keyword">isset</span>( $_POST[<span class="string">'password'</span>] ) ) &#123;</span><br><span class="line">        <span class="comment">// Getting submitted user data from database</span></span><br><span class="line">        $db = <span class="keyword">new</span> mysqli($db_host, $db_user, $db_pass, $db_name);</span><br><span class="line">        $sql = $db-&gt;prepare(<span class="string">"SELECT * FROM users WHERE username = ?"</span>);</span><br><span class="line">        $sql-&gt;bind_param(<span class="string">'s'</span>, $_POST[<span class="string">'username'</span>]);</span><br><span class="line">        $sql-&gt;execute();</span><br><span class="line">        $result = $sql-&gt;get_result();</span><br><span class="line">    	$user = $result-&gt;fetch_object();</span><br><span class="line">    		</span><br><span class="line">    	<span class="comment">// Verify user password and set $_SESSION</span></span><br><span class="line">    	<span class="keyword">if</span> ( password_verify( $_POST[<span class="string">'password'</span>], $user-&gt;password ) ) &#123;</span><br><span class="line">    		$_SESSION[<span class="string">'user_id'</span>] = $user-&gt;ID;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Any protected page<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">isset</span>( $_SESSION[<span class="string">'user_id'</span>] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get user data if session exists</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Redirect to the login page</span></span><br><span class="line">    header(<span class="string">"Location: https://www.yourdomain.com/login.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Logout<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">session_destroy();</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="如何用-cookie-based-session-紀錄使用者狀態"><a href="#如何用-cookie-based-session-紀錄使用者狀態" class="headerlink" title="如何用 cookie-based session 紀錄使用者狀態"></a>如何用 cookie-based session 紀錄使用者狀態</h2><p>紀錄使用者狀態也可以單純只使用 cookie，把 user 的身份和其他資訊都存在 cookie 裡，然後 server 就只看這個 cookie 去判斷你是誰。<br>當然儲存的資訊都會經過加密處理，但是還是有被破解的風險，而且 cookie 有儲存大小 4k 的限制，所以實務上有可能會 session 和 cookie-based session 配合使用。</p>
<p>缺點：</p>
<ul>
<li>不適合存敏感資訊<br><br></li>
</ul>
<h2 id="再聊聊-persistent-cookie-amp-session-cookie"><a href="#再聊聊-persistent-cookie-amp-session-cookie" class="headerlink" title="再聊聊 persistent cookie &amp; session cookie"></a>再聊聊 persistent cookie &amp; session cookie</h2><p>概念上 cookie 又分成兩種：</p>
<ul>
<li><p>Persistent cookie</p>
<p>  就是明確指定 cookie 的存活時間，直到指定的時間為止，即便瀏覽器關閉 cookie 依然活著。</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcookie(<span class="string">"TestCookie"</span>, $value, time() + <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Session cookie </p>
<p>  session cookie 則是相反，不指定存活時間，只活在這個瀏覽器的 session 期間，關閉瀏覽器後就被清除了。但是實測後發現如果在 chrome 上有勾選<code>繼續瀏覽上次開啟的網頁(Ｃontinue where you letf off)</code>，session cookie 是不會被清除的。<a href="https://stackoverflow.com/questions/10617954/chrome-doesnt-delete-session-cookies" target="_blank" rel="noopener">Ref</a><br><br></p>
</li>
</ul>
<h2 id="比較一下-cookie-amp-local-storage-amp-session-storage"><a href="#比較一下-cookie-amp-local-storage-amp-session-storage" class="headerlink" title="比較一下 cookie &amp; local storage &amp; session storage"></a>比較一下 cookie &amp; local storage &amp; session storage</h2><p>HTML5 新增的兩種儲存方式： local storage &amp; session storage，下面把他們與 cookie 做一下比較。</p>
<table>
<thead>
<tr>
<th></th>
<th>Cookies</th>
<th>Local Storage</th>
<th>Session Storage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Capacity</td>
<td>4kb</td>
<td>10mb</td>
<td>5mb</td>
</tr>
<tr>
<td>Browsers</td>
<td>HTML4/HTML5</td>
<td>HTML5</td>
<td>HTML5</td>
</tr>
<tr>
<td>Accessible from</td>
<td>Any winodw</td>
<td>Any winodw</td>
<td>Same tab</td>
</tr>
<tr>
<td>Expires</td>
<td>Manually set</td>
<td>Never</td>
<td>On tab close</td>
</tr>
<tr>
<td>Storage Location</td>
<td>Browser and server</td>
<td>Browser only</td>
<td>Browser only</td>
</tr>
<tr>
<td>Sent with requests</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Restriction</td>
<td>Same domain</td>
<td>Same domain</td>
<td>Same domain</td>
</tr>
</tbody>
</table>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://fred-zone.blogspot.com/2014/01/web-session.html" target="_blank" rel="noopener">http://fred-zone.blogspot.com/2014/01/web-session.html</a><br><a href="https://www.johnmorrisonline.com/build-php-login-form-using-sessions/" target="_blank" rel="noopener">https://www.johnmorrisonline.com/build-php-login-form-using-sessions/</a><br><a href="https://www.youtube.com/watch?v=AwicscsvGLg" target="_blank" rel="noopener">https://www.youtube.com/watch?v=AwicscsvGLg</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuchitung.github.io/2019/04/15/identify-users-with-cookie-and-session/" data-id="cjxevxj230008u4y5n6vshbh9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-pattern/">design-pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/job/">job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/">laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oop/">oop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solid/">solid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timezone/">timezone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/design-pattern/" style="font-size: 10px;">design-pattern</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/job/" style="font-size: 10px;">job</a> <a href="/tags/laravel/" style="font-size: 10px;">laravel</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/oop/" style="font-size: 20px;">oop</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/solid/" style="font-size: 20px;">solid</a> <a href="/tags/timezone/" style="font-size: 10px;">timezone</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/web/" style="font-size: 15px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/28/cross-origin-resource-sharing/">CORS 的介紹與實作</a>
          </li>
        
          <li>
            <a href="/2019/06/24/dependency-inversion-principle/">依賴反轉原則</a>
          </li>
        
          <li>
            <a href="/2019/06/24/interface-segregation-principle/">介面隔離原則</a>
          </li>
        
          <li>
            <a href="/2019/06/24/least-knowledge-principle/">最小知識原則</a>
          </li>
        
          <li>
            <a href="/2019/06/24/liskov-substitution-principle/">里氏替換原則</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Yuchi Tung<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>